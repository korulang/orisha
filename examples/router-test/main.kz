// Test: Router transform with pattern branches - SIMPLIFIED

~import "$orisha"
~import "$std/io"

const std = @import("std");

// Define a test request struct (matches orisha.Request)
const TestRequest = struct {
    method: []const u8,
    path: []const u8,
};

// Test different routes
const req_root = TestRequest{ .method = "GET", .path = "/" };
const req_about = TestRequest{ .method = "GET", .path = "/about" };
const req_user = TestRequest{ .method = "GET", .path = "/users/42" };
const req_post = TestRequest{ .method = "POST", .path = "/" };

// Test 1: Should match [GET /] - no binding (empty payload)
~orisha:router(req: &req_root)
| [GET /] |> std.io:print.ln("1: matched GET /")
| [GET /about] |> std.io:print.ln("1: matched GET /about")
| [GET /users/:id] _ |> std.io:print.ln("1: matched user (discarded)")
| [*] |> std.io:print.ln("1: catch-all")

// Test 2: Should match [GET /about] - no binding
~orisha:router(req: &req_about)
| [GET /] |> std.io:print.ln("2: matched GET /")
| [GET /about] |> std.io:print.ln("2: matched GET /about")
| [GET /users/:id] _ |> std.io:print.ln("2: matched user (discarded)")
| [*] |> std.io:print.ln("2: catch-all")

// Test 3: Should match [GET /users/:id] with param extraction
~orisha:router(req: &req_user)
| [GET /] |> std.io:print.ln("3: matched GET /")
| [GET /about] |> std.io:print.ln("3: matched GET /about")
| [GET /users/:id] p |> std.io:print.ln("3: matched user id={{ p.id:s }}")
| [*] |> std.io:print.ln("3: catch-all")

// Test 4: Should fall through to catch-all
~orisha:router(req: &req_post)
| [GET /] |> std.io:print.ln("4: matched GET /")
| [GET /about] |> std.io:print.ln("4: matched GET /about")
| [GET /users/:id] _ |> std.io:print.ln("4: matched user (discarded)")
| [*] |> std.io:print.ln("4: catch-all")
